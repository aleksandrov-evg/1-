ВЫБРАТЬ
	Сборки.Наименование КАК Наименование,
	МИНИМУМ((ВЫРАЗИТЬ(ЕСТЬNULL(ОстаткиМатериаловОстатки.КоличествоОстаток, 0) / СборкиКомплектующиеВСборке.Количество + 0.5 КАК ЧИСЛО(12, 0))) - 1) КАК ВозможноеКоличество,
	ОстаткиМатериаловОстатки.Склад КАК Склад
ПОМЕСТИТЬ втРАсчетКоличестваСборок
ИЗ
	Справочник.Сборки.КомплектующиеВСборке КАК СборкиКомплектующиеВСборке
		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Сборки КАК Сборки
		ПО (СборкиКомплектующиеВСборке.Ссылка = Сборки.Ссылка)
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиМатериалов.Остатки(
				,
				Материал В
					(ВЫБРАТЬ
						СборкиКомплектующиеВСборке.Комплектующая КАК Комплектующая
					ИЗ
						Справочник.Сборки.КомплектующиеВСборке КАК СборкиКомплектующиеВСборке)) КАК ОстаткиМатериаловОстатки
		ПО (ОстаткиМатериаловОстатки.Материал = СборкиКомплектующиеВСборке.Комплектующая
				И ОстаткиМатериаловОстатки.Склад = &Склад)

СГРУППИРОВАТЬ ПО
	Сборки.Наименование,
	ОстаткиМатериаловОстатки.Склад
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втРАсчетКоличестваСборок.Наименование КАК Наименование,
	втРАсчетКоличестваСборок.ВозможноеКоличество КАК ВозможноеКоличество,
	втРАсчетКоличестваСборок.Склад КАК Склад
ИЗ
	втРАсчетКоличестваСборок КАК втРАсчетКоличестваСборок
ГДЕ
	втРАсчетКоличестваСборок.ВозможноеКоличество > 0
